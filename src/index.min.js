hello=document.querySelector('#hello'),document.addEventListener('click',clickHandler),document.addEventListener('keydown',keyDownHandler);let closeBar=document.querySelector('#closeBar'),pulloutTab=document.querySelector('.pullout-tab');pulloutTab.addEventListener('click',showGallery),closeBar.addEventListener('click',closeGallery),document.addEventListener('DOMContentLoaded',getSongs);let submitSong=document.querySelector('#submit'),eventArray=[[{beat:''}],[],[],[]],rec_start=0,recording_track=0,current_track=0,current_beat,songData=[[]],modalClose=document.querySelector('#modalClose'),all_rec_btns=document.querySelectorAll('.record'),all_play_btns=document.querySelectorAll('.play'),play_all_button=document.querySelector('#play_all'),save_button=document.querySelectorAll('.save'),all_del_btns=document.querySelectorAll('.delete');all_play_btns.forEach(c=>c.disabled=!0),save_button.forEach(c=>c.disabled=!0),all_del_btns.forEach(c=>c.disabled=!0);function setup(){sounds={coin:loadSound('assets/coin.wav'),horn:loadSound('assets/horn.wav'),beep:loadSound('assets/musicnote4.wav'),boop:loadSound('assets/musicnote6.wav'),ping:loadSound('assets/musicnote5.wav'),rockBeat:loadSound('assets/rockBeat.wav'),funkBeat:loadSound('assets/funkBeat.wav'),shuffleBeat:loadSound('assets/shuffleBeat.wav'),airhorn:loadSound('assets/airhorn.mp3'),synthC:loadSound('assets/musicnote1C.wav'),synthD:loadSound('assets/musicnote1D.wav'),synthE:loadSound('assets/musicnote1E.wav'),synthF:loadSound('assets/musicnote1F.wav'),synthG:loadSound('assets/musicnote1G.wav'),synthA:loadSound('assets/musicnote1A.wav'),synthB:loadSound('assets/musicnote1B.wav'),synthC2:loadSound('assets/musicnote1C2.wav'),catC:loadSound('assets/catC.wav'),catD:loadSound('assets/catD.wav'),catE:loadSound('assets/catE.wav'),catF:loadSound('assets/catF.wav'),catG:loadSound('assets/catG.wav'),catA:loadSound('assets/catA.wav'),catB:loadSound('assets/catB.wav'),catC2:loadSound('assets/catC2.wav')},createCanvas(0,0)}function draw(){}function getSongs(){fetch('https://powerful-retreat-90633.herokuapp.com/api/v1/songs').then(c=>c.json()).then(c=>addToList(c))}function addToList(c){c.data.forEach(d=>makeTemplate(d))}function makeTemplate(c){songData.push(c.attributes['song-data']),document.querySelector('.song-list').innerHTML+=`<li>${c.attributes.name} ||
	<a class="play-button" id="${c.id}" href="#">PLAY</a></li><br/>`}function clickHandler(c){if(c.target.classList.contains('sound')){if(0<recording_track){c.preventDefault(),sounds[c.target.id].play(),sounds[c.target.id].setVolume(0.3);let d=c.target.id,f=c.timeStamp;eventArray[recording_track].push({sound:d,time:f})}else sounds[c.target.id].play(),sounds[c.target.id].setVolume(0.3);}else if(c.target.classList.contains('record')){if('Record'===c.target.innerText){loadBar(c),recording_track=parseInt(c.target.dataset.id);let f=c.timeStamp;startRecording(c.timeStamp,recording_track);eventArray[recording_track].push({sound:'record',time:f})}else{let f=c.timeStamp;eventArray[recording_track].push({sound:'stop',time:f}),resetRec()}}else if(c.target.classList.contains('play')){if(current_track=parseInt(c.target.dataset.id),'play_all'===c.target.id){let d=mergeTracks();loadBar(c),playTrack(d)}else soundTimesArray=mapArray(current_track),playTrack(soundTimesArray);}else if('submit'===c.target.id){let d=document.querySelector('#artistName').value,f=document.querySelector('#songTitle').value;fetch('https://powerful-retreat-90633.herokuapp.com/api/v1/songs',{method:'POST',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify({name:`${f}`,song_data:JSON.stringify(eventArray),artist_name:`${d}`})}),document.getElementById('modalClose').click()}else if('play-button'===c.target.className){let d=c.target.id;eventArray=songData[d],eventArray=JSON.parse(eventArray);let f=mergeTracks();playTrack(f)}else if(c.target.classList.contains('delete')){let d=c.target.dataset.id;eventArray[d]=[],alert(`track ${d} deleted!`),resetButtons()}}function keyDownHandler(c){if(0<recording_track){let d,f,g;switch(c.key){case'1':c.preventDefault(),sounds.coin.play(),sounds.coin.setVolume(0.3),d='coin',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'2':c.preventDefault(),sounds.horn.play(),sounds.horn.setVolume(0.3),d='horn',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'3':c.preventDefault(),sounds.beep.play(),sounds.beep.setVolume(0.3),d='beep',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'4':c.preventDefault(),sounds.boop.play(),sounds.boop.setVolume(0.3),d='boop',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'5':c.preventDefault(),sounds.ping.play(),sounds.ping.setVolume(0.3),d='ping',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'q':c.preventDefault(),sounds.synthC.play(),sounds.synthC.setVolume(0.3),d='synthC',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'w':c.preventDefault(),sounds.synthD.play(),sounds.synthD.setVolume(0.3),d='synthD',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'e':c.preventDefault(),sounds.synthE.play(),sounds.synthE.setVolume(0.3),d='synthE',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'r':c.preventDefault(),sounds.synthF.play(),sounds.synthF.setVolume(0.3),d='synthF',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case't':c.preventDefault(),sounds.synthG.play(),sounds.synthG.setVolume(0.3),d='synthG',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'y':c.preventDefault(),sounds.synthA.play(),sounds.synthA.setVolume(0.3),d='synthA',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'u':c.preventDefault(),sounds.synthB.play(),sounds.synthB.setVolume(0.3),d='synthB',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'i':c.preventDefault(),sounds.synthC2.play(),sounds.synthC2.setVolume(0.3),d='synthC2',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'a':c.preventDefault(),sounds.catC.play(),sounds.catC.setVolume(0.3),d='catC',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case's':c.preventDefault(),sounds.catD.play(),sounds.catD.setVolume(0.3),d='catD',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'd':c.preventDefault(),sounds.catE.play(),sounds.catE.setVolume(0.3),d='catE',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'f':c.preventDefault(),sounds.catF.play(),sounds.catF.setVolume(0.3),d='catF',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'g':c.preventDefault(),sounds.catG.play(),sounds.catG.setVolume(0.3),d='catG',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'h':c.preventDefault(),sounds.catA.play(),sounds.catA.setVolume(0.3),d='catA',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'j':c.preventDefault(),sounds.catB.play(),sounds.catB.setVolume(0.3),d='catB',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'k':c.preventDefault(),sounds.catC2.play(),sounds.catC2.setVolume(0.3),d='catC2',f=c.timeStamp,g={sound:d,time:f},eventArray[recording_track].push(g);break;case'Enter':sounds.airhorn.play(),sounds.airhorn.setVolume(0.5);}}else switch(c.key){case'1':sounds.coin.play(),sounds.coin.setVolume(0.3),buttonFeedback('coin');break;case'2':sounds.horn.play(),sounds.horn.setVolume(0.3),buttonFeedback('horn');break;case'3':sounds.beep.play(),sounds.beep.setVolume(0.3),buttonFeedback('beep');break;case'4':sounds.boop.play(),sounds.boop.setVolume(0.3),buttonFeedback('boop');break;case'5':sounds.ping.play(),sounds.ping.setVolume(0.3),buttonFeedback('ping');break;case'q':sounds.synthC.play(),sounds.synthC.setVolume(0.3),buttonFeedback('synthC');break;case'w':sounds.synthD.play(),sounds.synthD.setVolume(0.3),buttonFeedback('synthD');break;case'e':sounds.synthE.play(),sounds.synthE.setVolume(0.3),buttonFeedback('synthE');break;case'r':sounds.synthF.play(),sounds.synthF.setVolume(0.3),buttonFeedback('synthF');break;case't':sounds.synthG.play(),sounds.synthG.setVolume(0.3),buttonFeedback('synthG');break;case'y':sounds.synthA.play(),sounds.synthA.setVolume(0.3),buttonFeedback('synthA');break;case'u':sounds.synthB.play(),sounds.synthB.setVolume(0.3),buttonFeedback('synthB');break;case'i':sounds.synthC2.play(),sounds.synthC2.setVolume(0.3),buttonFeedback('synthC2');break;case'a':sounds.catC.play(),sounds.catC.setVolume(0.3),buttonFeedback('catC');break;case's':sounds.catD.play(),sounds.catD.setVolume(0.3),buttonFeedback('catD');break;case'd':sounds.catE.play(),sounds.catE.setVolume(0.3),buttonFeedback('catE');break;case'f':sounds.catF.play(),sounds.catF.setVolume(0.3),buttonFeedback('catF');break;case'g':sounds.catG.play(),sounds.catG.setVolume(0.3),buttonFeedback('catG');break;case'h':sounds.catA.play(),sounds.catA.setVolume(0.3),buttonFeedback('catA');break;case'j':sounds.catB.play(),sounds.catB.setVolume(0.3),buttonFeedback('catB');break;case'k':sounds.catC2.play(),sounds.catC2.setVolume(0.3),buttonFeedback('catC2');break;case'Enter':sounds.airhorn.play(),sounds.airhorn.setVolume(0.5);}}function startRecording(c,d){eventArray[d]=[],setBeat(),rec_start=c,rec_btn=document.querySelector(`#record_${d}`),all_rec_btns.forEach(f=>f.disabled=!0),all_play_btns.forEach(f=>f.disabled=!0),save_button.forEach(f=>f.disabled=!0),all_del_btns.forEach(f=>f.disabled=!0),rec_btn.disabled=!1,all_rec_btns.forEach(f=>f.classList.add('disabledBtn')),rec_btn.classList.remove('disabledBtn'),play_all_button.disabled=!0,rec_btn.innerText='Stop',disabledButtons=document.querySelectorAll('.disabledBtn'),oT1=disabledButtons[0].dataset.id,oT2=disabledButtons[1].dataset.id,0<eventArray[oT1].length&&(sTA2=mapArray(oT1),playTrackWithoutStop(sTA2)),0<eventArray[oT2].length&&(sTA3=mapArray(oT2),playTrackWithoutStop(sTA3))}function setBeat(){let c=document.querySelector('#beat_dropdown');current_beat=c.options[c.selectedIndex].value;let d=current_beat;sounds[d].loop(),sounds[d].setVolume(4),eventArray[0][0].beat=d,document.getElementById('beat_dropdown').hidden=!0}function resetRec(){resetButtons(),all_rec_btns.forEach(g=>g.classList.remove('disabledBtn')),rec_btn.innerText='Record';let c=document.querySelector('#play_all');c.disabled=!1,recording_track=0;let d=document.querySelector('#beat_dropdown'),f=d.options[d.selectedIndex].value;sounds[f].stop(),clearInterval(intervalID)}function mapArray(c){return 0<eventArray[c].length?(track_time=eventArray[c][0].time,eventArray[c].map(function(d){return{sound:d.sound,time:d.time-track_time}})):[]}function playTrack(c){all_play_btns.forEach(f=>f.disabled=!0),all_rec_btns.forEach(f=>f.disabled=!0),save_button.forEach(f=>f.disabled=!0),all_del_btns.forEach(f=>f.disabled=!0),c.shift();let d=c.pop();sounds[eventArray[0][0].beat].loop(),sounds[eventArray[0][0].beat].setVolume(4),setTimeout(()=>{sounds[eventArray[0][0].beat].stop(),clearInterval(intervalID)},d.time),c.forEach(f=>setTimeout(()=>playSound(f.sound),f.time)),setTimeout(()=>{resetButtons()},d.time)}function resetButtons(){all_play_btns[1].disabled=!(0<eventArray[1].length),all_play_btns[2].disabled=!(0<eventArray[2].length),all_play_btns[3].disabled=!(0<eventArray[3].length),all_del_btns[0].disabled=!(0<eventArray[1].length),all_del_btns[1].disabled=!(0<eventArray[2].length),all_del_btns[2].disabled=!(0<eventArray[3].length),all_rec_btns.forEach(c=>c.disabled=!1),all_play_btns[0].disabled=!0,save_button.forEach(c=>c.disabled=!0),(0<eventArray[1].length||0<eventArray[2].length||0<eventArray[3].length)&&(save_button.forEach(c=>c.disabled=!1),all_play_btns[0].disabled=!1)}function playTrackWithoutStop(c){c.shift();c.pop();sounds[eventArray[0][0].beat].play(),sounds[eventArray[0][0].beat].setVolume(4),c.forEach(f=>setTimeout(()=>playSound(f.sound),f.time))}function playSound(c){sounds[c].play(),sounds[c].setVolume(0.3)}function mergeTracks(){let c=[[{beat:current_beat}]],d=mapArray(1);d.shift(),track1StopTime=d.pop();let f=mapArray(2);f.shift(),track2StopTime=f.pop();let g=mapArray(3);g.shift(),track3StopTime=g.pop(),allStopTimes=[track1StopTime,track2StopTime,track3StopTime],allStopTimes=allStopTimes.filter(function(j){return j!=void 0}),sortedStopTimes=allStopTimes.sort(function(j,k){return j.time-k.time}),longest=[sortedStopTimes[sortedStopTimes.length-1]];let h=[...d,...f,...g];h.sort((j,k)=>j.time-k.time);let i=[...c,...h,...longest];return i}let mainPlay=document.getElementById('play_all'),mainTrack=document.getElementById('mainTrack'),layerOne=document.getElementById('layerOne'),layerTwo=document.getElementById('layerTwo'),layerThree=document.getElementById('layerThree'),recordL1=document.getElementById('record_1'),recordL2=document.getElementById('record_2'),recordL3=document.getElementById('record_3'),intervalID;function loadBar(c){let d=0;intervalID=window.setInterval(function(){switch(100==d?d=0:d+=5,c.target.id){case'play_all':mainTrack.style.width=d+'%';break;case'record_1':layerOne.style.width=d+'%';break;case'record_2':layerTwo.style.width=d+'%';break;case'record_3':layerThree.style.width=d+'%';}},500)}function showGallery(){let d=document.getElementById('sidebar');'none'===d.style.display?(d.style.display='block',pulloutTab.style.display='none'):(d.style.display='none',pulloutTab.style.display='block')}function closeGallery(){let d=document.getElementById('sidebar');d.style.display='none',pulloutTab.style.display='block'}function buttonFeedback(c){document.getElementById(c).style.background='white',setTimeout(()=>document.getElementById(c).style.background='#343a40',60)}
